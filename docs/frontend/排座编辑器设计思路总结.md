## 项目背景

ToG 项目，第三方公司有一个 OA 系统，需要我们做一个会议室排座系统作为 OA 系统中的一个模块，核心功能是输入一份人员名单，输出人员座位图。

## 前期技术调研

整个项目可以理解为一个 H5 编辑器，市面上常见的 H5 编辑器实现方式有两种：DOM 与 Canvas 。但我认为这并不是本质上的区别，在后期我认为根本上在于坐标系建立的方式。

## 系统设计

PC 端: 编辑会议室模板以及会议室排座

平板端：针对小型会议室进行排座（逻辑与 PC 不同）

手机管理端：管理会议中人员签到状态

手机客户端：扫码签到页面

## 流程设计

1. **制定会议室模板**
2. **发起会议，导入人员，输出一份人员座位图**
3. 通过浙政钉通知参会人员
4. **管理员通过浙政钉 H5 微应用管理会议以及人员签到状态**
5. 会议开始前 5 分钟，参会人员通过扫码进行签到

## 会议室模板

一个会议室可能要开多次会议，所以要建立会议室模板来进行复用。先来看看常见的电影院购票软件是怎么这做的，如下图所示：

![淘票票选座截图](C:%5CUsers%5CIves%5CDesktop%5C20211216135744.jpg)

类似这种是较为简单的排版，共有 3 种元素：银幕、座位及过道。而在会议室中，我们需要展示：座位、过道、舞台（大会议室中主讲人坐的位置）。其实一开始还考虑加入桌子的，后续没做主要是两个原因：一是不利于页面排版， 二是桌子代表的语义其实与椅子重复。

### 建立网格坐标系

> **这是非常关键的一步**，藉此，无限的二维坐标集合 -> 有限个索引集合，大大地降低了开发时的心智负担。

通过 grid 布局来建立网格坐标系。划分网格的线，称为"网格线"（grid line）。水平网格线划分出行，垂直网格线划分出列。正常情况下，`n`行有`n + 1`根水平网格线，`m`列有`m + 1`根垂直网格线，比如三行就有四根水平网格线。

![flex布局-阮一峰](C:%5CUsers%5CIves%5CDesktop%5C20211216144901.png)

### 放置元素

座位：建立坐标系后要将元素添加到其中，一个格子代表一个座位，后续添加人员后人员将会与座位绑定，人员的信息会被展现到座位上。

过道：长宽并不固定。例如，假设第 1 列的第 1 至 10 排都是座位；第 1 列的 11 排及之后都是过道且第 2 列的第 1 至第 10 排是过道。那么 1-3 的位置实际代表了**1排2座**， 11-2 实际代表了**11排1座**。

舞台：实际一开始设计时并没有设计这个元素，由于舞台上一定有座位，所以舞台实际是一些特殊座位的集合，普通座位的集合我们将其称为区域，这个后面会讲到。

*PS：过道的存在使得索引值并不能代表真实的排座，在展示时需要额外一个字段来代表。*

## 人员座位图

### 流程

流程大致如下：选择已有的会议室模板 -> 划分区域 -> 将人员导入指定区域（具体规则由后端制定，理论上也是完全可以由前端来做）。

### 划分区域

通过构建会议室模板，此时我们已经拥有包含座位、舞台、过道元素的网格坐标系。接下来要划分区域，由于网格实际上是一个个 DOM 节点，所以通过设置网格的 `border` 属性就可以实现划分区域。

### 导入人员

将人员导入指定区域时，后台会返回包含网格索引的数据，作为前端不需要关系具体的规则，因为返回的是一个包含网格序号的人员集合。

### 手动调整人员座位

主要操作是在座位上插入与删除人员。这里有个小细节，列表通常不会改变顺序，所以 `v-for` 时不会有大问题。但是，这里这里很明显是会改变顺序的，所以用 `index` 作为 `key` 就不太合适了。建议去看看这篇文章——[掘金：《在 Vue 中为什么不推荐用 index 做 key》](httjps://juejin.cn/post/7026119446162997261)。

*PS:实际上人员座位图我们还做了许多逻辑，例如过道不能坐人；导入人员超出座位后要返回未排座人员集合等等，但这些都是业务逻辑，不再赘述。*

## 通知参会人员

通过调用浙政钉的 api 进行通知，用户查看通知的时候访问的是一个带 id 的（或是座位索引）的链接，前端从 url 中取出渲染指定座位到页面上。

## 扫码进行签到

这部分并不是特别了解，每个用户看到的签到页面都是一样的，在点击签到按钮的时会带上浙政钉的 api 。

## 手机管理端踩坑记录

1. svg 图片无法显示。

2. 不要使用 rem 作为单位，浏览器中正常的页面到 H5 微应用中会乱（这也可能是由于我使用自适应 REM 布局的关系）。

3. 顶部导航栏始终存在，仅在通过 JSAPI 进行旋转屏幕时会隐藏。正常状态下仅能设置标题以及左右按钮，在 UI 设计时要和提前沟通好。

4. 不要使用外部字体资源，加载速度非常之慢。

[掘金：《钉钉H5微应用开发总结》](https://juejin.cn/post/7010677123052470279)