# Vue3在浙里办的实践

## 观前提醒

本人并非浙里办工作人员，不保证内容完全准确，若开发中有疑问，请先阅读完钉钉群内所有开发文档，再咨询钉钉群相关“技术支持”人员。若还是无法解决，请在掘金文章下留言，勿直接私信本人。

## 前言

八月底曾在掘金发过一篇[《浙里办H5开发受苦记录》](https://juejin.cn/post/7136923056097722398)，简单阐述了一些浙里办对接相关的问题。由于当时没有发布应用，很多东西没有得到检验。因项目功能的扩展，项目整体后面进行了多次重构，我对一些工具库也进行了封装，遂决定重新总结一篇文章。本文将从以下几方面展开：

1. 浙里办H5开发前需知
2. 项目构建与技术选型
3. 浙里办对接过程中遇到的问题及解决方案
4. 项目一些需求的实现思路

### 浙里办H5开发前需知

### 章节概要

本章节主要阐述一些浙里办开发涉及到的基础概念。应用开发前的申请流程，本人并不清楚，不做介绍。

### 浙里办

浙里办是一款基于浙江政务服务网一体化平台能力的APP。我们开发的应用可以通过浙里办App、支护宝小程序及微信小程序访问。

### IRS

[IRS](https://op-irs.zj.gov.cn/mobile/login?goto=/mobile)指浙江省一体化数字资源系统平台。应用申请流程走完后会拿到IRS账号，我们在IRS上进行应用（指前端包）的部署与发布以及RPC接口的管理与更新。

### RPC

RPC服务器是指Remote Procedure Call Protocol，中文释义为远程过程调用协议：一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。

由于审核要求，浙里办客户端不直接请求服务器，通过Mgop(相关描述请见下文)将请求发送至RPC服务器，再转发给真实的服务器。

### Mgop

Mgop指Npm上的包[@aligov/jssdk-mgop](https://www.npmjs.com/package/@aligov/jssdk-mgop)，提供请求RPC上API的能力，有外网[语雀文档](https://www.yuque.com/xiaoniaoge/run4dl/dge18k?)。

### 单点登录组件

由于应用存在APP、微信、支付宝这三种环境，需要通过不同的单点登录组件获取登录态。目前提供三种组件：

1. 政务服务网个人用户单点登录：支持App、支付宝小程序、服务服务网PC，需配置回调地址，入参为ticket。

2. 政务服务网法人用户单点登录：支持App、政务服务网pc端，需配置回调地址。

3. ”浙里办“统一单点登录：支持微信浙里办小程序、支付宝小程序，不涉及配置回调地址，入参为ticketId，不能与上述ticket作为入参混用。

   **注：据群内”技术支持“描述，小程序拿到的票据始终为ticketId。但我实际开发过程中发现，九月时对接单点支付宝小程序获得的票据为ticketId，而自11月底起只能获取到ticket，且官方提供ssoTicket方法返回的ticketId始终为空。**

### 票据

指ticket与ticketId，使用不同的单点登录时需要使用不同票据，不能混用。

## 项目构建与技术选型

### 章节概要

本章节主要介绍构建项目中对技术选型的一些思考。

### 本项目使用的技术栈

- [Vue@3.2](https://link.juejin.cn/?target=mailto%3AVue%403.2)
- [TypeScript@5.4](https://link.juejin.cn/?target=mailto%3ATypeScript%405.4)
- VueCli@5
- [VantUi@3.5](https://link.juejin.cn/?target=mailto%3AVantUi%403.5)
- Pinia@2
- [Axios@0.27](https://link.juejin.cn/?target=mailto%3AAxios%400.27)
- [zwjsbridge@1.1.0](https://link.juejin.cn/?target=mailto%3Azwjsbridge%401.1.0)
- [zwlog@1.0](https://link.juejin.cn/?target=mailto%3Azwlog%401.0)

### Vue2还是Vue3

由于这个项目一开始的定位是一个小项目，团队配置就是一个前端加一个前端，所以项目前端架构由我自己把控。团队的技术栈以Vue2为主，不过我个人会倾向使用Vue3，一来在Vue3中通过composabler的形式可以更好地进行代码复用，二来这对我个人的成长也更有帮助。不过最后能否使用Vue3还是要根据运行环境来决定，好在经过多方调查，最后确认可以上Vue3。

### Vite还是Webpack

没有选用Vite的主要原因在于项目是通过VueCli构建的，我对这一套生态更加熟悉。加上当时了解到工期很紧，害怕使用Vite会遇到一些坑拖慢项目进度。不过现在VueCli已经进入了维护模式，加上VueConf2022上看到许多大公司已经将Vite用于生产环境，下一次构建项目时我会选择Vite。

### Pinia还是Vuex

毫无疑问是Pinia，它非常轻量，使用起来相当简洁。而且尤大在一次掘金的直播中明确表示了Pinia就是下一代Vuex，出于对作者的尊重所以没有改名。

### Aplus还是Zwlog

二者都是浙里办提供的埋点工具，浙里办官方更推荐使用新版的Zwlog。

### Vant

老牌组件库，成熟的使用方案与优秀的文档，我个人开发移动端时最常用的组件库。

## 浙里办对接过程中遇到的问题及解决方案

## 一些需求的实现思路

