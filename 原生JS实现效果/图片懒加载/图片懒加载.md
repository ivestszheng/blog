>懒加载(Load On Demand)是一种独特而又强大的数据获取方法,它能够在用户滚动页面的时候自动获取更多的数据,而新得到的数据不会影响原有数据的显示,同时最大程度上减少服务器端的资源耗用。

![懒加载效果预览](https://raw.githubusercontent.com/ivestszheng/images-store/master/img/20210522202842.gif)

## 01-原理

一张图片就是一个`<img>`标签，浏览器是否发起请求图片是根据`<img>`的src属性，所以实现懒加载的关键就是，在图片没有进入可视区域时，先不给`<img>`的src赋值，这样浏览器就不会发送请求了，等到图片进入可视区域再给src赋值。

## 02-实现思路

实现懒加载有四个步骤

> 1. 加载loading图片
> 2. **判断哪些图片要加载**
> 3. 隐形加载图片
> 4. 替换真图片

判断图片进入可视区域(图源网络)

![](D:%5CUsers%5CPictures%5CTemp%5C20190524164645631.png)

如上图所示，让在浏览器可视区域的图片显示，可视区域外的不显示，**所以当图片距离顶部的距离top-height等于可视区域h和滚动区域高度s之和时说明图片马上就要进入可视区了，就是说当top-height<=s+h时，图片在可视区。**

## 03-代码实现

在`html`中加载`loading`图片，`src`是加载时显示的图片，`data-src`是真正的图片路径，代码如下：

```html
    <div class="imgList">
        <img class="lazy" src="img/loading.gif" data-src="img/pic1.jpg" alt="pic">
        <img class="lazy" src="img/loading.gif" data-src="img/pic2.jpg" alt="pic">
        <img class="lazy" src="img/loading.gif" data-src="img/pic3.jpg" alt="pic">
        <img class="lazy" src="img/loading.gif" data-src="img/pic4.jpg" alt="pic">
        <img class="lazy" src="img/loading.gif" data-src="img/pic5.png" alt="pic">
        <img class="lazy" src="img/loading.gif" data-src="img/pic6.jpg" alt="pic">
    </div>
```

`css`部分代码如下：

```css
        .imgList {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .lazy {
            width: 500px;
            height: 500px;
        }
```

`JS`部分代码如下:

```js
    // HTMLElement.offsetTop 为只读属性，它返回当前元素相对于其 offsetParent 元素的顶部的距离。
    // window.innerHeight 为浏览器窗口的视口（viewport）高度（以像素为单位）；如果有水平滚动条，也包括滚动条高度。
    // onload() 等所有的资源文件加载完毕以后再绑定事件
    window.onload = () => {
        // 获取图片列表，即img标签列表
        var imgs = document.querySelectorAll('img');

        // 获取到浏览器顶部的距离
        function getTop(e) {
            return e.offsetTop;
        }

        // 懒加载实现
        function lazyload(imgs) {
            // 可视区域高度
            var h = window.innerHeight;
            //滚动区域高度
            var s = document.documentElement.scrollTop || document.body.scrollTop;
            for (var i = 0; i < imgs.length; i++) {
                //图片距离顶部的距离小于可视区域和滚动区域之和时懒加载
                if ((h + s) > getTop(imgs[i])) {
                    // 真实情况是页面开始有2秒空白，所以使用setTimeout定时2s
                    (i => {
                        setTimeout(() => {
                            // 不加立即执行函数i会等于9
                            // 隐形加载图片或其他资源，
                            //创建一个临时图片，这个图片在内存中不会到页面上去。实现隐形加载
                            var temp = new Image();
                            temp.src = imgs[i].getAttribute('data-src');//只会请求一次
                            // onload判断图片加载完毕，真是图片加载完毕，再赋值给dom节点
                            temp.onload = () => {
                                // 获取自定义属性data-src，用真图片替换假图片
                                imgs[i].src = imgs[i].getAttribute('data-src')
                            }
                        }, 2000)
                    })(i)
                }
            }
        }
        lazyload(imgs);

        // 滚屏函数
        window.onscroll = () => {
            lazyload(imgs);
        }
    }
```



参考：[js实现图片懒加载原理](https://blog.csdn.net/w1418899532/article/details/90515969)